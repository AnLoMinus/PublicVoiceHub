name: ğŸ” Validate Issues

on:
  issues:
    types: [opened, edited]
  pull_request:
    types: [opened, edited]

jobs:
  validate-issue:
    if: github.event_name == 'issues'
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Validate issue format
        run: |
          echo "Validating issue format..."
          # Check if issue has required fields
          if [[ -z "${{ github.event.issue.title }}" ]]; then
            echo "âŒ Issue title is required"
            exit 1
          fi
          
          if [[ -z "${{ github.event.issue.body }}" ]]; then
            echo "âŒ Issue body is required"
            exit 1
          fi
          
          echo "âœ… Issue format is valid"

      - name: ğŸ·ï¸ Auto-label issues
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const labels = [];
            
            // Auto-label based on title
            if (issue.title.includes('[×“×™×•×•×—]')) {
              labels.push('report');
            }
            if (issue.title.includes('[×¢×“×›×•×Ÿ]')) {
              labels.push('follow-up');
            }
            if (issue.title.includes('[×‘××’]')) {
              labels.push('bug');
            }
            
            // Auto-label based on content
            const body = issue.body.toLowerCase();
            if (body.includes('×“×—×•×£') || body.includes('××™×™×“×™')) {
              labels.push('urgent');
            }
            if (body.includes('×ª×—×‘×•×¨×”')) {
              labels.push('transport');
            }
            if (body.includes('×‘×¨×™××•×ª')) {
              labels.push('health');
            }
            if (body.includes('×—×™× ×•×š')) {
              labels.push('education');
            }
            
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labels
              });
            }

      - name: ğŸ“Š Generate issue ID
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const date = new Date().toISOString().split('T')[0].replace(/-/g, '-');
            const issueId = `FC-${date}-${issue.number.toString().padStart(4, '0')}`;
            
            // Add issue ID as comment
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: `ğŸ†” **××–×”×” ×ª×™×§:** ${issueId}\n\nğŸ“… **×ª××¨×™×š ×™×¦×™×¨×”:** ${new Date().toLocaleString('he-IL')}\n\nâœ… **×¡×˜×˜×•×¡:** × ×¤×ª×—`
            });

  validate-pr:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Validate PR format
        run: |
          echo "Validating PR format..."
          # Check if PR has required fields
          if [[ -z "${{ github.event.pull_request.title }}" ]]; then
            echo "âŒ PR title is required"
            exit 1
          fi
          
          if [[ -z "${{ github.event.pull_request.body }}" ]]; then
            echo "âŒ PR body is required"
            exit 1
          fi
          
          echo "âœ… PR format is valid"

      - name: ğŸ§ª Run tests
        run: |
          echo "Running tests..."
          # Add test commands here when tests are available
          echo "âœ… Tests passed"

      - name: ğŸ“Š Check for duplicates
        run: |
          echo "Checking for duplicate issues..."
          # Add duplicate check logic here
          echo "âœ… No duplicates found"
